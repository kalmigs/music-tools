---
description: Checklist when adding new pages/features
globs: src/routes/**/*.tsx
alwaysApply: false
---

# Adding New Pages/Features

## Planning Questions

Before implementing, answer these:

- How do you suggest we implement it?
- Do we need to install any packages?
- What functions and options should it have?
- What is the ideal route path?

## Required: Show Text Layout

**Always show a rough text layout for desktop and mobile before implementing.** Use ASCII art to visualize:

```
┌─────────────────────────────┐
│  Header / TopNav            │
├─────────────────────────────┤
│                             │
│  Main content area          │
│                             │
├─────────────────────────────┤
│  Controls / Footer          │
└─────────────────────────────┘
```

Include layouts for any dialogs/modals as well.

## Implementation Guidelines

- Follow `file-organization.mdc` throughout implementation
- Reusable hooks go in `src/hooks/` (use-*.ts)
- Reusable utility functions go in `src/lib/`
- Add query parameters for page settings (see `query-params.mdc`)
- Add to: desktop nav, mobile sidebar, and homepage

---

## Update Checklist

When adding a new page or feature, update these locations:

## 1. Create the Route

```
src/routes/[page-name].tsx
```

## 2. Update Sidebar Navigation

Add to `src/lib/nav.ts`:

```tsx
{
  title: 'Page Name',
  href: '/page-name',
  icon: IconName,
  description: 'Brief description',
}
```

## 3. Update Home Page

Add a card or link in `src/routes/index.tsx` if the feature should be discoverable from home.

## 4. Update README

Add the feature to the Features section in `README.md`:

```markdown
## Features

- **Page Name** - Brief description
```

## 5. Register Keyboard Shortcuts (if applicable)

If the page has keyboard shortcuts, register them for the help popover in TopNav:

```tsx
import { useRegisterShortcuts } from '@/hooks/use-keyboard-shortcuts';

function MyPage() {
  // Register shortcuts - auto-unregisters on unmount
  useRegisterShortcuts([
    { key: 'Space', label: 'Start / Stop' },
    { key: 'T', label: 'Tap tempo' },
  ]);

  // Also implement the actual keyboard handler
  useEffect(() => {
    const handleKeyDown = (e: KeyboardEvent) => {
      const target = e.target as HTMLElement;
      if (target.tagName === 'INPUT' || target.tagName === 'TEXTAREA' || target.isContentEditable) {
        return;
      }
      if (e.code === 'Space') {
        e.preventDefault();
        // handle action
      }
    };
    window.addEventListener('keydown', handleKeyDown);
    return () => window.removeEventListener('keydown', handleKeyDown);
  }, []);
}
```

## Checklist

- [ ] Route file created in `src/routes/`
- [ ] Navigation item added to `src/lib/nav.ts`
- [ ] Home page updated (if applicable)
- [ ] README.md features list updated
- [ ] Query parameters for settings (if applicable)
- [ ] Keyboard shortcuts registered (if applicable)
